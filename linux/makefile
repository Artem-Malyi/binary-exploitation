BUILD_DIR=build
FLAGS=-zexecstack -fno-stack-protector -fno-pie -fno-pic -g -O0 -mpreferred-stack-boundary=2 -m32

all: rwret shellcode nfshellcode overflow example1 example2 fuzzer1 fuzzer2 jmpesp

help:
	cat README

prep:
	mkdir -p ${BUILD_DIR}

rwret: prep
	gcc step1/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

shellcode: prep
	gcc step2/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

nfshellcode: prep
	gcc step3/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

example1: prep
	as step2/$@.s --32 -o ${BUILD_DIR}/$@.o
	ld ${BUILD_DIR}/$@.o -m elf_i386 -o ${BUILD_DIR}/$@

example2: prep
	as step3/$@.s --32 -o ${BUILD_DIR}/$@.o
	ld ${BUILD_DIR}/$@.o -m elf_i386 -o ${BUILD_DIR}/$@

overflow: prep
	gcc step4/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

vulnerable1: prep
	gcc step5/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

generator1: prep
	gcc step5/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

fuzzer1: prep generator1 vulnerable1
	cp -af step5/$@.sh ${BUILD_DIR} && chmod a+x ${BUILD_DIR}/$@.sh

vulnerable2: prep
	gcc step6/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

generator2: prep
	gcc step6/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

fuzzer2: prep generator2 vulnerable2
	cp -af step6/$@.sh ${BUILD_DIR} && chmod a+x ${BUILD_DIR}/$@.sh

jmpesp: prep
	gcc step7/vulnerable3.c ${FLAGS} -o ${BUILD_DIR}/vulnerable3

clean:
	rm -rf ${BUILD_DIR}

