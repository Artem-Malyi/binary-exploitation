BUILD_DIR=build
FLAGS=-zexecstack -fno-stack-protector -fno-pie -fno-pic -g -O0 -mpreferred-stack-boundary=2 -m32

all: rwret shellcode nfshellcode overflow example1 example2 fuzzer

help:
	cat README

prep:
	mkdir -p ${BUILD_DIR}

rwret: prep
	gcc step1/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

shellcode: prep
	gcc step2/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

nfshellcode: prep
	gcc step3/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

example1: prep
	as step2/$@.s --32 -o ${BUILD_DIR}/$@.o
	ld ${BUILD_DIR}/$@.o -m elf_i386 -o ${BUILD_DIR}/$@

example2: prep
	as step3/$@.s --32 -o ${BUILD_DIR}/$@.o
	ld ${BUILD_DIR}/$@.o -m elf_i386 -o ${BUILD_DIR}/$@

overflow: prep
	gcc step4/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

vulnerable: prep
	gcc step5/$@.c ${FLAGS} -o ${BUILD_DIR}/$@

fuzzer: prep vulnerable
	gcc step5/generator.c ${FLAGS} -o ${BUILD_DIR}/generator

clean:
	rm -rf ${BUILD_DIR}

